<!DOCTYPE html>
<html lang="uk">
<head>
  <meta charset="UTF-8">
  <title>VR PC Builder</title>
  <script src="https://aframe.io/releases/1.4.0/aframe.min.js"></script>
  <script src="https://unpkg.com/super-hands@3.0.4/dist/super-hands.min.js"></script>
  <style>
    body { margin: 0; font-family: Arial, sans-serif; }
    .info { position: absolute; bottom: 10px; left: 10px; background: rgba(0,0,0,0.7); color: white; padding: 10px; border-radius: 5px; font-size: 14px; width: 250px; z-index: 10000; }
  </style>
</head>
<body>
  <a-scene>
    <a-assets>
      <a-asset-item id="case-model" src="models/case.glb"></a-asset-item>
      <a-asset-item id="motherboard-model" src="models/motherboard.glb"></a-asset-item>
      <a-asset-item id="cpu-model" src="models/cpu.glb"></a-asset-item>
      <a-asset-item id="ram-model" src="models/ram.glb"></a-asset-item>
      <a-asset-item id="gpu-model" src="models/gpu.glb"></a-asset-item>
      <a-asset-item id="psu-model" src="models/psu.glb"></a-asset-item>
      <a-asset-item id="ssd-model" src="models/ssd.glb"></a-asset-item>
      <a-mixin id="interactive" hoverable grabbable draggable></a-mixin>
    </a-assets>

    <a-sky color="#ECECEC"></a-sky>

    <!-- ПК корпус -->
    <a-entity position="0 0.8 -1.5" pc-builder>
      <a-box position="0 0.05 0" width="0.6" height="0.01" depth="0.7" color="#4d4d4d"></a-box>
      <a-entity id="pc-case">
        <a-gltf-model src="#case-model" scale="0.2 0.2 0.2" position="0 0 0"></a-gltf-model>
      </a-entity>

      <!-- Компоненти -->
      <a-entity id="components-container">
        <a-entity id="motherboard" class="component" data-type="motherboard" position="0 0.1 0" scale="0.3 0.3 0.3" mixin="interactive">
          <a-gltf-model src="#motherboard-model"></a-gltf-model>
        </a-entity>
        <a-entity id="cpu" class="component" data-type="cpu" position="0 0 0" scale="0.3 0.3 0.3" mixin="interactive">
          <a-gltf-model src="#cpu-model"></a-gltf-model>
        </a-entity>
        <a-entity id="ram" class="component" data-type="ram" position="0 0 0" scale="0.3 0.3 0.3" mixin="interactive">
          <a-gltf-model src="#ram-model"></a-gltf-model>
        </a-entity>
        <a-entity id="gpu" class="component" data-type="gpu" position="0 0 0" scale="0.3 0.3 0.3" mixin="interactive">
          <a-gltf-model src="#gpu-model"></a-gltf-model>
        </a-entity>
        <a-entity id="psu" class="component" data-type="psu" position="0 0 0" scale="0.3 0.3 0.3" mixin="interactive">
          <a-gltf-model src="#psu-model"></a-gltf-model>
        </a-entity>
        <a-entity id="ssd" class="component" data-type="ssd" position="0 0 0" scale="0.3 0.3 0.3" mixin="interactive">
          <a-gltf-model src="#ssd-model"></a-gltf-model>
        </a-entity>
      </a-entity>
    </a-entity>

    <!-- Камера та руки -->
    <a-entity id="rig">
      <a-camera id="camera" position="0 1.6 0" look-controls wasd-controls="fly: true">
        <a-cursor></a-cursor>
      </a-camera>
      <a-entity hand-controls="hand: left" super-hands></a-entity>
      <a-entity hand-controls="hand: right" super-hands></a-entity>
    </a-entity>

    <script>
      // Логіка встановлення компонентів
      AFRAME.registerComponent('pc-builder', {
        init: function () {
          this.installed = new Set();
          this.tick = AFRAME.utils.throttleTick(this.checkComponents, 200, this);
        },
        checkComponents: function () {
          const comps = document.querySelectorAll('.component:not(.installed)');
          comps.forEach(el => {
            if (el.is('grabbed')) return;
            const current = el.object3D.position;
            const target = new THREE.Vector3();
            el.object3D.parent.worldToLocal(target.copy(el.object3D.getWorldPosition(new THREE.Vector3())));
            if (current.distanceTo(target) < 0.1) {
              this.install(el);
            }
          });
        },
        install: function (el) {
          el.classList.add('installed');
          el.object3D.position.set(
            el.getAttribute('position').x,
            el.getAttribute('position').y,
            el.getAttribute('position').z
          );
          el.object3D.rotation.set(0, 0, 0);
        }
      });

      // hover ефекти
      AFRAME.registerComponent('hoverable', {
        init: function () {
          this.el.addEventListener('hover-start', () => {
            this.el.querySelectorAll('a-gltf-model').forEach(m => m.setAttribute('material', 'color: #ffff00'));
          });
          this.el.addEventListener('hover-end', () => {
            if (!this.el.is('grabbed')) {
              this.el.querySelectorAll('a-gltf-model').forEach(m => m.removeAttribute('material'));
            }
          });
          this.el.addEventListener('grab-start', () => {
            this.el.querySelectorAll('a-gltf-model').forEach(m => m.setAttribute('material', 'color: #ff0000'));
          });
          this.el.addEventListener('grab-end', () => {
            this.el.querySelectorAll('a-gltf-model').forEach(m => m.removeAttribute('material'));
          });
        }
      });
    </script>
  </a-scene>

  <div class="info">
    <strong>VR Controls:</strong><br>
    - Grab: Trigger<br>
    - Move: WASD / Thumbstick<br>
    - Place components inside the case to install them
  </div>
</body>
</html>

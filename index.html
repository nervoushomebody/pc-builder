<!DOCTYPE html>
<html lang="uk">
<head>
  <meta charset="UTF-8">
  <title>VR Збирач ПК - Фінал</title>
  <script src="https://aframe.io/releases/1.4.0/aframe.min.js"></script>
  <script src="https://cdn.jsdelivr.net/gh/c-frame/aframe-physics-system@v4.1.0/dist/aframe-physics-system.min.js"></script>
  <script src="https://unpkg.com/super-hands@3.0.4/dist/super-hands.min.js"></script>
  <style>body { margin: 0; }</style>
</head>

<body>
<a-scene physics="gravity: -5">
  <a-assets>
    <a-asset-item id="case-model" src="models/case.glb"></a-asset-item>
  </a-assets>

  <a-plane rotation="-90 0 0" width="20" height="20" color="#777" static-body></a-plane>

  <!-- Корпус без static-body -->
  <a-entity id="pc-case-station" position="0 0.8 -1.5">
    <a-entity id="pc-case">
      <a-gltf-model src="#case-model" scale="0.5 0.5 0.5"></a-gltf-model>
    </a-entity>

    <!-- Невидима платформа всередині -->
    <a-box position="0 0.1 0" width="0.6" height="0.01" depth="0.7" static-body visible="false"></a-box>
  </a-entity>

  <!-- Камера -->
  <a-entity id="rig">
    <a-camera position="0 1.6 0">
      <a-cursor></a-cursor>
    </a-camera>
  </a-entity>

  <!-- Магнітне притягування з силою 5 -->
  <script>
    AFRAME.registerComponent('magnet-attraction', {
      schema: {
        hand: {type: 'string', default: 'left'},
        strength: {type: 'number', default: 5},
        maxDistance: {type: 'number', default: 2}
      },
      init: function () {
        this.attractedObjects = [];
        this.raycaster = new THREE.Raycaster();
        this.direction = new THREE.Vector3();
        this.triggerPressed = false;
        this.el.addEventListener('triggerdown', () => this.triggerPressed = true);
        this.el.addEventListener('triggerup', () => {
          this.triggerPressed = false;
          this.attractedObjects = [];
        });
      },
      tick: function () {
        if (!this.triggerPressed) return;
        const handPos = new THREE.Vector3();
        this.el.object3D.getWorldPosition(handPos);
        this.el.object3D.getWorldDirection(this.direction);
        this.raycaster.set(handPos, this.direction);
        const interactiveEls = Array.from(document.querySelectorAll('[mixin="interactive"]'));
        const interactiveObjs = interactiveEls.map(el => el.object3D);
        const intersects = this.raycaster.intersectObjects(interactiveObjs, true);
        if (intersects.length > 0) {
          const target = intersects[0].object.el;
          if (!this.attractedObjects.includes(target) &&
              target.components['dynamic-body'] &&
              target.object3D.position.distanceTo(handPos) < this.data.maxDistance) {
            this.attractedObjects.push(target);
          }
        }
        this.attractedObjects.forEach(target => {
          if (!target || !target.body || target.is('grabbed')) return;
          const targetPos = new THREE.Vector3();
          target.object3D.getWorldPosition(targetPos);
          const forceDir = new THREE.Vector3().subVectors(handPos, targetPos)
              .normalize().multiplyScalar(this.data.strength);
          target.body.velocity.set(forceDir.x, forceDir.y, forceDir.z);
        });
      }
    });

    document.querySelector('a-scene').addEventListener('loaded', () => {
      document.querySelector('#rig').setAttribute('magnet-attraction', '');
    });
  </script>

</a-scene>
</body>
</html>

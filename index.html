<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <title>VR Збирач ПК - Фінальна версія</title>
    <script src="https://aframe.io/releases/1.4.0/aframe.min.js"></script>
    <script src="https://unpkg.com/super-hands@3.0.4/dist/super-hands.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/aframe-extras@6.1.1/dist/aframe-extras.min.js"></script>
    <script src="https://unpkg.com/aframe-event-set-component@^4.1.1/dist/aframe-event-set-component.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/c-frame/aframe-physics-system@v4.1.0/dist/aframe-physics-system.min.js"></script>
    <script src="https://unpkg.com/aframe-physics-extras/dist/aframe-physics-extras.min.js"></script>
    
    <style>
        body { margin: 0; font-family: Arial, sans-serif; }
        .info {
            position: absolute;
            bottom: 10px;
            left: 10px;
            background: rgba(0,0,0,0.7);
            color: white;
            padding: 10px;
            border-radius: 5px;
            font-size: 14px;
            width: 250px;
        }
    </style>
</head>
<body>
    <a-scene physics="gravity: -9.8">
        <a-assets>
            <img id="ground" src="https://cdn.aframe.io/a-painter/images/floor.jpg">
            <img id="sky" src="https://cdn.aframe.io/a-painter/images/sky.jpg">

            <a-asset-item id="case-model" src="models/case.glb"></a-asset-item>
            <a-asset-item id="motherboard-model" src="models/motherboard.glb"></a-asset-item>
            <a-asset-item id="cpu-model" src="models/cpu.glb"></a-asset-item>
            <a-asset-item id="ram-model" src="models/ram.glb"></a-asset-item>
            <a-asset-item id="gpu-model" src="models/gpu.glb"></a-asset-item>
            <a-asset-item id="psu-model" src="models/psu.glb"></a-asset-item>
            <a-asset-item id="ssd-model" src="models/ssd.glb"></a-asset-item>
            
            <a-mixin id="interactive"
                     hoverable grabbable draggable respawnable>
            </a-mixin>

            <a-mixin id="physics-hands"
                     physics-collider phase-shift
                     collision-filter="collisionForces: false"
                     static-body="shape: sphere; sphereRadius: 0.02"
                     super-hands="colliderEvent: collisions;
                                  colliderEventProperty: els;
                                  colliderEndEvent: collisions;
                                  colliderEndEventProperty: clearedEls;">
            </a-mixin>
        </a-assets>

        <a-sky src="#sky"></a-sky>
        <a-plane id="ground-plane" src="#ground" rotation="-90 0 0" width="20" height="20" static-body></a-plane>
        
        <a-entity id="pc-case-station" position="0 0.8 -1.5">
             <a-box position="0 0.5 0" width="0.6" height="0.1" depth="0.7" color="#4d4d4d" static-body></a-box>
             <a-entity id="pc-case" static-body>
                <a-gltf-model src="#case-model" scale="1 1 1" position="0 0 0"></a-gltf-model>
            </a-entity>
        </a-entity>


        <a-entity id="motherboard" mixin="interactive" position="1.2 1.2 0" 
                  dynamic-body="shape: box; boxSize: 0.3 0.02 0.35"
                  side-description="description: Motherboard - connects all components.; offset: 0 0.1 -0.25">
            <a-gltf-model src="#motherboard-model" rotation="0 0 0" scale="1 1 1"></a-gltf-model>
        </a-entity>
        
        <a-entity id="cpu" mixin="interactive" position="-0.8 1.2 -1" 
                  dynamic-body="shape: box; boxSize: 0.08 0.02 0.08"
                  side-description="description: CPU (Processor) - the brain of the computer.; offset: 0.15 0 0">
            <a-gltf-model src="#cpu-model" rotation="0 0 0" scale="1 1 1"></a-gltf-model>
        </a-entity>

        <a-entity id="ram" mixin="interactive" position="-0.8 1.2 0.8" 
                  dynamic-body="shape: box; boxSize: 0.12 0.02 0.03"
                  side-description="description: RAM (Random Access Memory) - short-term memory.; offset: 0.16 0 0">
            <a-gltf-model src="#ram-model" rotation="0 0 0" scale="1 1 1"></a-gltf-model>
        </a-entity>
        
        <a-entity id="gpu" mixin="interactive" position="-1.2 1.2 0" 
                  dynamic-body="shape: box; boxSize: 0.25 0.03 0.15"
                  side-description="description: GPU (Graphics Card) - processes graphics.; offset: 0 0.05 0.2">
            <a-gltf-model src="#gpu-model" rotation="0 0 0" scale="1 1 1"></a-gltf-model>
        </a-entity>

        <a-entity id="psu" mixin="interactive" position="0.8 1.2 -1" 
                  dynamic-body="shape: box; boxSize: 0.15 0.08 0.15"
                  side-description="description: Power Supply Unit - provides power.; offset: 0.18 0.05 0">
            <a-gltf-model src="#psu-model" rotation="0 0 0" scale="1 1 1"></a-gltf-model>
        </a-entity>

        <a-entity id="ssd" mixin="interactive" position="0.8 1.2 0.8" 
                  dynamic-body="shape: box; boxSize: 0.1 0.01 0.07"
                  side-description="description: SSD (Solid State Drive) - long-term storage.; offset: 0.15 0 0">
            <a-gltf-model src="#ssd-model" rotation="0 0 0" scale="1 1 1"></a-gltf-model>
        </a-entity>

        <a-light type="ambient" color="#404040"></a-light>
        <a-light type="directional" position="0 5 0" rotation="-90 0 0" intensity="0.6"></a-light>

        <a-entity id="rig" position="0 0 0" movement-controls="speed: 0.3; controls: left" thumbstick-turn="hand: right">
            <a-camera id="camera" position="0 1.6 0" look-controls wasd-controls>
                <a-cursor id="cursor" raycaster="objects: [mixin='interactive']"></a-cursor>
            </a-camera>
            <a-entity id="leftHand" mixin="physics-hands" hand-controls="hand: left"></a-entity>
            <a-entity id="rightHand" mixin="physics-hands" hand-controls="hand: right"></a-entity>
        </a-entity>

        <script>
            // Shows a description on the side of an entity when it is grabbed
            AFRAME.registerComponent('side-description', {
              schema: {
                description: {type: 'string', default: 'Item description.'},
                offset: {type: 'vec3', default: {x: 0.3, y: 0, z: 0}}
              },
              init: function () {
                const el = this.el;
                const data = this.data;
                this.descriptionText = document.createElement('a-text');
                this.descriptionText.setAttribute('value', data.description);
                this.descriptionText.setAttribute('align', 'left');
                this.descriptionText.setAttribute('position', data.offset);
                this.descriptionText.setAttribute('width', '2');
                this.descriptionText.setAttribute('look-at', '#camera');
                this.descriptionText.setAttribute('visible', false);
                el.appendChild(this.descriptionText);

                el.addEventListener('grab-start', () => { this.descriptionText.setAttribute('visible', true); });
                el.addEventListener('grab-end', () => { this.descriptionText.setAttribute('visible', false); });
              }
            });

            // Respawns an entity if it falls
            AFRAME.registerComponent('respawnable', {
              init: function () {
                this.initialPosition = this.el.object3D.position.clone();
              },
              tick: function () {
                if (this.el.object3D.position.y < -5 && !this.el.is('grabbed')) {
                  this.resetEntity();
                }
              },
              resetEntity: function() {
                const el = this.el;
                el.object3D.position.copy(this.initialPosition);
                if (el.body) {
                  el.body.position.copy(this.initialPosition);
                  el.body.velocity.set(0, 0, 0);
                  el.body.angularVelocity.set(0, 0, 0);
                }
              }
            });

            // Prevents hands from knocking things away
            AFRAME.registerComponent('phase-shift', {
              init: function () {
                  var el = this.el;
                  el.addEventListener('gripdown', () => el.setAttribute('collision-filter', {collisionForces: true}));
                  el.addEventListener('gripup', () => el.setAttribute('collision-filter', {collisionForces: false}));
              }
            });

            // Visual feedback on hover and grab
            AFRAME.registerComponent('hoverable', {
              init: function () {
                  var el = this.el;
                  el.originalColor = el.getAttribute('material') ? el.getAttribute('material').color : '#FFF';
                  el.addEventListener('hover-start', function (evt) { 
                    evt.target.querySelectorAll('a-gltf-model').forEach(model => model.setAttribute('material', 'color', '#ffff00'));
                  });
                  el.addEventListener('hover-end', function (evt) { 
                    if (!el.is('grabbed')) {
                      evt.target.querySelectorAll('a-gltf-model').forEach(model => model.removeAttribute('material'));
                    }
                  });
                  el.addEventListener('grab-start', function (evt) { 
                    evt.target.querySelectorAll('a-gltf-model').forEach(model => model.setAttribute('material', 'color', '#ff0000'));
                  });
                  el.addEventListener('grab-end', function (evt) {
                    if (el.is('hovered')) {
                      evt.target.querySelectorAll('a-gltf-model').forEach(model => model.setAttribute('material', 'color', '#ffff00'));
                    } else {
                      evt.target.querySelectorAll('a-gltf-model').forEach(model => model.removeAttribute('material'));
                    }
                  });
              }
            });
        </script>
    </a-scene>

    <div class="info">
        <strong>Керування:</strong><br>
        Корпус ПК перед вами. Компоненти розташовані навколо вас.<br><br>
        <strong>VR:</strong><br>
         - <strong>Взяти:</strong> Простягніть руку і натисніть Тригер/Grip.<br>
         - <strong>Рух:</strong> Лівий джойстик.<br>
         - <strong>Поворот:</strong> Правий джойстик.<br>
         - <strong>Інфо:</strong> При захопленні предмета збоку з'явиться опис.<br><br>
        <strong>Desktop:</strong> WASD для руху, миша для огляду.
        <br><br>
        <strong>Мета:</strong> Зібрати ПК, перетягуючи компоненти в корпус!
    </div>
</body>
</html>
